# NSFC-Writer：国家自然科学基金申请书智能写作助手

基于大语言模型（LLM）技术构建的国家自然科学基金（NSFC）项目申请书智能写作辅助系统，旨在提升科研项目申请书的撰写效率与质量。

---

## 📋 目录

- [概述](#概述)
- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [使用方法](#使用方法)
- [Web 界面](#web-界面)
- [高级功能：模型微调](#高级功能模型微调)
- [项目结构](#项目结构)
- [配置说明](#配置说明)
- [最佳实践](#最佳实践)

---

## 概述

本系统提供了一个智能写作支持框架，具备以下能力：
- **自动化生成** 项目申请书内容  
- **科学化评审** 并提供可操作的改进建议  
- **智能文献管理** 支持参考文献整合  

> 核心入口实现位置：`main.py:17-19`

---

## 功能特性

### 🖊️ 智能内容生成

自动生成功能覆盖基金申请全流程的六大核心模块：

- 研究背景与意义  
- 研究内容  
- 研究方案  
- 创新点  
- 预期成果  
- 研究基础  

> 实现位置：`generator.py:19-80`

### 📝 智能申请书评审

基于自然语言处理（NLP）技术对申请书草稿进行深度分析，提供全面评审支持：

- 各模块量化评分  
- 逻辑性与合规性诊断  
- 针对性修改建议  
- 自动生成优化版本  

> 实现位置：`app.py:593-651`

### 📚 智能文献管理

基于向量数据库技术，实现多格式文献资源的全生命周期管理：

- 支持 PDF、Word、Markdown 等多种格式  
- 自动内容解析与向量数据库构建  
- 主题相关文献检索  
- 生成过程中自动推荐引用文献  

> 配置位置：`config.yaml:70-75`

### 🤖 双模型架构

灵活可扩展的模型框架，支持两种部署模式：

| 模式 | 说明 |
|------|-------------|
| **Ollama 模式** | 兼容多种开源大模型，支持快速部署与切换 |
| **本地微调模式** | 使用领域数据训练定制模型，提升专业适配能力 |

> 实现位置：`main.py:75-88`

---

## 快速开始

### 前置条件

#### 1. Conda 环境配置

```bash
conda create -n nsfc python=3.10
conda activate nsfc

# 进入 Pytorch 官网
# 根据 CUDA 版本选择对应的 Pytorch 版本
# 建议使用 pip 命令安装

pip install -r requirements.txt
```


#### 2. Ollama 安装（推荐）

1. 从 [ollama.ai](https://ollama.ai) 下载 Ollama 客户端安装包  
2. 根据[手动安装教程](https://blog.csdn.net/luningyu_1/article/details/156913022?sharetype=blogdetail&sharerId=156913022&sharerefer=PC&sharesource=luningyu_1&spm=1011.2480.3001.8118)，安装 Ollama 客户端， 并配置开机启动服务：
3. 下载推荐模型：

```bash
ollama pull qwen2.5:14b       # 下载 Qwen2.5-14B 模型
```

---

## 使用方法

### 系统状态检查

```bash
python main.py info
```

显示 Ollama 服务状态、可用模型列表及文献索引状态。

> 实现位置：`main.py:160-223`

### 文献导入

**单个文件：**
```bash
python main.py add_literature paper.pdf
```

**批量导入（目录）：**
```bash
python main.py add_literature --directory ./papers/
```

> 实现位置：`main.py:136-158`

### Web 界面（推荐）

```bash
python main.py run
```

通过浏览器访问可视化界面：`http://127.0.0.1:7860`

> 配置位置：`config.yaml:86-88`

### 命令行生成

**单个模块：**
```bash
python main.py generate -t "基于深度学习的医学图像分析" -s research_background
```

**完整申请书：**
```bash
python main.py generate -t "你的研究主题" -s all -o output.md
```

> 实现位置：`main.py:101-134`

---

## Web 界面

Web 界面采用模块化设计，包含四个核心功能标签页：

| 标签页 | 功能描述 | 参考位置 |
|--------|----------|----------|
| **模型设置** | 切换 Ollama 与本地微调模型，监控模型状态 | `app.py:799-844` |
| **申请书评审** | 上传 Word/PDF 草稿，生成评分报告、诊断结果，并导出优化版本 | `app.py:846-920` |
| **文献管理** | 拖拽上传、自动解析、索引构建与智能引文匹配 | `app.py:922-952` |
| **模块生成** | 输入研究主题，选择生成模块，添加领域信息，支持在线编辑与多格式导出 | - |

---

## 高级功能：模型微调

为满足领域定制需求，系统支持本地模型微调：

### 步骤 1：准备训练数据

收集领域相关的申请书样本（Markdown 格式），存放于 `data/raw/` 目录。

### 步骤 2：数据预处理

```bash
python main.py process_data --input_dir ./data/raw
```

执行数据清洗、格式标准化与特征提取。

> 实现位置：`main.py:49-62`

### 步骤 3：模型训练

```bash
python main.py train --data ./data/processed/training_data.json
```

使用预处理后的数据进行模型微调。训练完成后将自动启动 Web 界面。

> 实现位置：`main.py:64-73`

---

## 项目结构

```
nsfc_writer/
├── configs/                    # 配置文件目录
│   └── config.yaml             # 主配置文件（模型、服务、文献等设置）
├── src/                        # 源代码目录
│   ├── app.py                  # Web 应用核心
│   ├── generator.py            # 申请书内容生成
│   ├── literature_manager.py   # 文献管理与检索
│   ├── trainer.py              # 模型训练与微调
│   └── ...                     # 其他工具模块
├── data/                       # 数据存储目录
│   ├── raw/                    # 原始训练样本
│   └── literature_db/          # 文献向量数据库
├── models/                     # 模型文件（预训练与微调后）
├── main.py                     # 主入口（命令行接口）
└── environment.yml             # 环境依赖清单
```

---

## 配置说明

所有核心配置均在 `configs/config.yaml` 中管理：

| 配置类别 | 参数说明 |
|----------|----------|
| **Model** | 基础模型选择、微调参数、生成策略 |
| **Ollama** | 服务地址、端口、模型名称 |
| **Literature** | 向量模型、文本分块大小、索引参数 |
| **Generation** | 温度（temperature）、最大 token 数、输出格式 |

> 完整配置范围：`config.yaml:1-88`

---

## 最佳实践

| 建议 | 说明 |
|------|------|
| **首次使用者** | 建议从 Ollama 模式开始，无需本地训练即可快速上手 |
| **文献数据库** | 导入本领域高质量期刊论文、综述及成功获批的申请书 |
| **写作策略** | 推荐“模块化生成 → 逐项优化 → 整合定稿”流程，提升整体质量 |
| **评审流程** | 多轮使用评审功能，重点关注研究背景逻辑性与创新点表述 |
| **参数调整** | 较高 temperature 值 = 更具创造性；较低 temperature 值 = 更严谨规范 |

---